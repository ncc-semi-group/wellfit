<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>502 study</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Gaegu&family=Jua&family=Nanum+Pen+Script&family=Playwrite+AU+SA:wght@100..400&family=Single+Day&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
   	<style>
        body *{
            font-family: 'Jua';
        }

        /*뒤로가기 버튼 + 제목 */
        .header {
            padding: 2rem;
            display: flex;
            align-items: center;
        }
        .back-btn {
        	font-size : 1.8rem;
            margin-right: 1rem;
        }

        .title {
            display: inline-block;
            padding-top: 0.7rem;
            font-size: 1.5rem;
        }
        
        .update-btn {
        	font-size : 1.8rem;
        	margin-left : auto; /*오른쪽 정렬*/
        }

        /* 프로필 사진 라인 */
        .profile {
            padding-left: 2rem;
            display: flex;
        }

        .profile-image {
            border-radius: 100%;
            width: 5rem;
            height: 5rem;
            object-fit: cover;
        }

        .profile-in {
            padding-left: 1.3rem;
        }

        .my-intro {
            padding-left: 2rem;
            padding-top: 0.7rem;
        }

        /*내 업적 부분*/
        .achievement {
            background-color: #E2F5F0;
            padding: 1rem;
        }
        .achievement-in {
            display: flex;
        }

        .ach-image {
            width: 6rem;
            height: 6rem;
            margin-left: 1rem;
            margin-bottom: 1.3rem;
        }

        .badge-cnt1 {
            width: 15rem;
            height: 12rem;
            text-align: center;
        }
        
        .badge-cnt2 {
            width: 15rem;
            height: 12rem;
            text-align: center;
        }

        /* 나의 활동 부분 */
        .h5 {
            padding: 1rem 1rem 0.2rem 1rem;
        }

        .box {
            display: flex;
        }
        .box-up {
            padding: 1rem;
            background-color: #005666;
            box-shadow: 4px 4px 5px #ccc;
            width: 50%;
            height: 3.5rem;
            color: #fff;
            text-align: center;
        }

        /*내 좋아요 목록*/
        .like-list {
            border: 1px solid #ccc;
            padding-bottom: 1.5rem;
            box-shadow: 2px 2px 5px 1px #ccc;
        }

        .like-list-in {
            display: flex;
            overflow: auto;
            white-space: nowrap;
            padding-left : 1rem;
        }
        /*스크롤바 숨기기*/
        .like-list-in::-webkit-scrollbar {
            display: none;
        }

        .like-list-inn {
            padding-right: 0.7rem;
        }

        .list1 {
            width: 6.2rem;
            height: 4.3rem;
            border-radius: 10% 10% 0% 0%;
            border: 1px solid #ccc;
            background-color: #C5EBE2;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        .list1-in {
            width: 6.2rem;
            height: 1.7rem;
            border-radius: 0% 0% 10% 10%;
            border: 1px solid #ccc;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tag-text {
            font-size: 0.9rem;
            color: #000;
            display: block;
            text-align: center;
            margin: 0 auto;
            padding: 0.3rem 0;
        }

        .like-count {
            font-size: 0.9rem;
            color: #333;
            text-align: center;
            margin: 0 auto;
            padding: 0;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="header">
        <i class="bi bi-arrow-left back-btn"></i>
        <h3 class="title">마이페이지</h3>
		<i class="bi bi-pencil-square update-btn"></i>
		<script>
		    $(document).ready(function() {
		        $('.update-btn').click(function() {
		            window.location.href = '/mypageupdate';
		        });
		    });
		</script>
    </div>

    <div th:if="${dto != null}">
        <div class="profile">
            <img th:src="@{${dto.profileImage != null and dto.profileImage.startsWith('/') ? 
                dto.profileImage : 
                (dto.profileImage != null ? '/images/' + dto.profileImage : '/static/images/default-profile.png')}}" 
                class="profile-image">
            <div class="profile-in">
                <h4 class="username" th:text="${dto.nickname}"></h4>
                <h5 class="info" th:text="${dto.gender == 'male' ? '남성' : '여성'} + ' / ' + ${dto.height} + ' / ' + ${dto.currentWeight}"></h5>
                <h6 class="friendcnt" th:text="'친구 ' + ${dto.friendCount}"></h6>
            </div>
        </div>

        <div class="my-intro">
            <h6>소개</h6>
            <h6 th:text="${dto.myIntro}"></h6>
        </div>
        <br>

        <div class="achievement">
            <h5>내 업적</h5>
            <div class="achievement-in">
                <div class="badge-cnt1" th:data-user-id="${dto.id}">
                    <img th:src="@{/static/images/업적.png}" class="ach-image">
                    <h5>보유 뱃지 수</h5>
                    <h4 th:text="${dto.badgeCount + '개'}" ></h4>
                    <script>
                    $(document).ready(function() {
                        $('.badge-cnt1').click(function() {
                            var userId = $(this).data('userId');
                            if (userId) {
                                window.location.href = '/mypageBadge?id=' + userId;
                            } else {
                                alert('사용자 정보를 찾을 수 없습니다.');
                            }
                        });
                    });
                    </script>
                </div>

                <div class="badge-cnt2">
                    <img th:src="@{/static/images/업적2.png}" class="ach-image">
                    <h5>목표 달성 수</h5>
                    <h4 th:text="${dto.achievementCount + '개'}"></h4>
                </div>
            </div>
        </div>

        <h5 class="h5">나의 활동</h5>
        <div>
            <div class="box">
                <div class="box-up">
                    <h4 class = "mypost" th:text="'내 게시글 ' + ${dto.postCount}" th:data-id="${dto.id}"></h4>
                    <script>
					    $(document).ready(function() {
					        $('.mypost').click(function() {
					            var userId = $(this).attr('data-id');
					            window.location.href = '/mypageActive?id=' + userId;
					        });
					    });
					</script>
                </div>
                <div class="box-up">
                    <h4 class="myComment" th:text="'내 댓글 ' + ${dto.commentCount}" th:data-id="${dto.id}"></h4>
                    <script>
					    $(document).ready(function() {
					        $('.myComment').click(function() {
					            var userId = $(this).attr('data-id');
					            window.location.href = '/mypageComment?id=' + userId;
					        });
					    });
					</script>
                </div>
            </div>

            <div class="like-list">
                <h5 class="h5">내 좋아요 목록</h5>
                <div class="like-list-in">
                    <div th:if="${likeList != null and !likeList.empty}" th:each="like : ${likeList}">
                        <div class="like-list-inn">
                            <div class="list1">
                                <h6 class="like-count" th:text="${like.likeCount + '개'}"></h6>
                            </div>
                            <div class="list1-in">
                                <span class="tag-text" th:text="${'#' + like.tag}"></span>
                            </div>
                        </div>
                    </div>
                    <div th:if="${likeList == null or likeList.empty}" class="text-center p-3">
                        <p>좋아요 목록이 없습니다.</p>
                    </div>
                </div>
                <script>
                    $(document).ready(function() {
                        $('.like-list-inn').click(function() {
                            var tag = $(this).find('.tag-text').text().substring(1); // '#' 제거
                            window.location.href = '/mypageLike?tag=' + encodeURIComponent(tag);
                        });
                    });
                </script>
            </div>
        </div>
    </div>
    <div th:unless="${dto != null}" class="text-center p-5">
        <h3>사용자를 찾을 수 없습니다.</h3>
        <p>데이터베이스에 해당 사용자 정보가 없습니다.</p>
    </div>
</div>
</body>
</html>
