<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/layout}">

<head>
<th:block layout:fragment="css">
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
    }

    .container {
        width: 375px;
        background-color: white;
        min-height: 90vh;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    /* Top search bar styles */
    .search-bar {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        border-bottom: 1px solid #e0e0e0;
        transition: transform 0.3s ease;
    }

    .search-bar.hidden {
        transform: translateY(-100%);
    }

    .search-options {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-grow: 1;
    }

    .search-option {
        font-size: 14px;
        font-weight: bold;
        color: #000;
        cursor: pointer;
    }

    .search-option.inactive {
        color: #888;
    }

    .search-tag {
        width: 25px;
        height: 25px;
        background-color: transparent;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    /* Category tabs styles */
    .category-tabs {
        display: flex;
        background-color: #fff;
        border-bottom: 1px solid #e0e0e0;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .category-tab {
        flex: 1;
        text-align: center;
        padding: 12px 0;
        font-size: 14px;
        color: #666;
        background: transparent;
        border: none;
        cursor: pointer;
    }

    .category-tab.active {
        color: #000;
        font-weight: bold;
        background-color: #E6EEF0;
    }

    .post-user {
        display: flex;
        align-items: center;
        padding: 10px;
    }

    .post-user-image {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        background-color: #ddd;
        overflow: hidden;
        cursor: pointer;
    }

    .post-user-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .post-user-info {
        flex-grow: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .post-user-details {
        display: flex;
        flex-direction: column;
    }

    .post-user-name {
        font-weight: bold;
    }

    .post-user-follower {
        color: #999;
        font-size: 12px;
    }

    .follow-button {
        background-color: #065F79;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        font-size: 12px;
        cursor: pointer;
    }

    .post-image {
        width: 100%;
        max-height: 500px;
        object-fit: cover;
    }

    .post-actions {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
    }

    .post-action-buttons {
        display: flex;
        gap: 15px;
    }

    .post-action-buttons button {
        background: none;
        border: none;
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
        cursor: pointer;
    }

    .post-caption {
        padding: 10px;
        font-size: 14px;
    }

    .hashtags-container {
        padding: 0 10px 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .hashtag {
        padding: 4px 10px;
        color: #8B8B8B;
        font-size: 12px;
        font-weight: 600;
        border-radius: 5px;
        background-color: #EFEFEF;
        display: inline-block;
    }

    /* Profile Modal Styles */
    .profile-modal {
        position: fixed;
        bottom: 40px;
        left: 0;
        right: 0;
        margin: 0 auto;
        max-width: 375px;
        background-color: #f3f9fb;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        z-index: 100;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        display: none;
    }

    .profile-modal.show {
        display: block;
    }

    .profile-modal-header {
        display: flex;
        justify-content: flex-end;
        padding: 10px;
    }

    .close-button {
        background: none;
        border: none;
        font-size: 20px;
        color: #888;
        cursor: pointer;
    }

    .profile-modal-content {
        padding: 10px 20px 20px;
        text-align: center;
    }

    .profile-image-large {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin: 0 auto 15px;
        overflow: hidden;
        background-color: #ddd;
    }

    .profile-image-large img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-name {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .profile-description {
        color: #888;
        font-size: 14px;
        margin-bottom: 20px;
    }

    .profile-stats {
        display: flex;
        justify-content: center;
        border-top: 1px solid #e0e0e0;
        border-bottom: 1px solid #e0e0e0;
        padding: 15px 0;
        margin-bottom: 20px;
    }

    .stat {
        flex: 1;
        text-align: center;
    }

    .stat-number {
        font-size: 18px;
        font-weight: bold;
    }

    .stat-label {
        font-size: 12px;
        color: #888;
    }

    .profile-actions {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .action-button {
        background-color: #f0f0f0;
        border: none;
        border-radius: 20px;
        padding: 8px 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    .bottom-nav-modal {
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
        border-top: 1px solid #e0e0e0;
    }

    .bottom-nav-item {
        text-align: center;
        flex: 1;
        cursor: pointer;
    }

    .bottom-nav-item svg {
        margin-bottom: 5px;
    }

    .bottom-nav-text {
        font-size: 10px;
        color: #888;
    }

    .bottom-nav-item.active .bottom-nav-text {
        color: #000;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99;
        display: none;
    }

    .modal-overlay.show {
        display: block;
    }

    /* 댓글 섹션 스타일 */
    .comments-modal {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        margin: 0 auto;
        max-width: 375px;
        height: 70vh;
        background-color: white;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        z-index: 100;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        display: none;
        flex-direction: column;
    }

    .comments-modal.show {
        display: flex;
    }

    .comments-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
    }

    .comments-title {
        font-weight: bold;
        flex-grow: 1;
        text-align: center;
    }

    .comments-list {
        flex-grow: 1;
        overflow-y: auto;
        padding: 10px 0;
    }

    .comment-item {
        display: flex;
        padding: 10px 15px;
    }

    .comment-user-image {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        margin-right: 10px;
        background-color: #ddd;
        overflow: hidden;
    }

    .comment-user-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .comment-content {
        flex-grow: 1;
    }

    .comment-user-name {
        font-weight: bold;
        margin-bottom: 2px;
    }

    .comment-text {
        font-size: 14px;
        line-height: 1.4;
    }

    .comment-time {
        font-size: 12px;
        color: #888;
        margin-top: 3px;
    }

    .comment-actions {
        display: flex;
        gap: 15px;
        margin-top: 5px;
        font-size: 12px;
        color: #888;
    }

    .comment-like, .comment-reply {
        cursor: pointer;
    }

    .comment-input-container {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        border-top: 1px solid #e0e0e0;
        background-color: white;
    }

    .comment-user-image-small {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-right: 10px;
        background-color: #ddd;
        overflow: hidden;
    }

    .comment-user-image-small img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .comment-input-wrapper {
        flex-grow: 1;
        display: flex;
        align-items: center;
        border-radius: 20px;
        background-color: #f0f0f0;
        padding: 8px 15px;
    }

    .comment-input {
        flex-grow: 1;
        border: none;
        background: transparent;
        outline: none;
        font-size: 14px;
    }

    .emoji-button {
        background: none;
        border: none;
        font-size: 16px;
        color: #888;
        padding: 0;
        margin-right: 10px;
        cursor: pointer;
    }

    .comment-submit {
        color: #065F79;
        font-weight: bold;
        font-size: 14px;
        background: none;
        border: none;
        padding: 0 5px;
        cursor: pointer;
    }

    .comment-submit:disabled {
        color: #ccc;
        cursor: default;
    }

    /* 이모지 선택기 */
    .emoji-selector {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
        background-color: #f8f8f8;
        border-top: 1px solid #e0e0e0;
        overflow-x: auto;
        white-space: nowrap;
    }

    .emoji-item {
        font-size: 24px;
        margin: 0 5px;
        cursor: pointer;
    }
    </style>
</th:block>
</head>
<body>

    <div layout:fragment="content">
        <div class="container">
            <div class="search-bar">
                <div class="search-options">
                    <span class="search-option active" id="allFeed">전체</span> <span
                        class="search-option inactive" id="followingFeed">팔로잉</span> <span
                        class="search-option inactive" id="popularFeed">인기</span>
                </div>
                <button class="search-tag">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    도라
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                </button>
            </div>
            <div class="category-tabs">
                <button class="category-tab active">전체</button>
                <button class="category-tab">식단</button>
                <button class="category-tab">레시피</button>
                <button class="category-tab">운동</button>
                <button class="category-tab">눈바디</button>
            </div>

            <div id="postsContainer"></div>
        </div>

        <!-- Modal Overlay -->
        <div class="modal-overlay" id="modalOverlay"></div>

        <!-- Profile Modal -->
        <div class="profile-modal" id="profileModal">
            <div class="profile-modal-header">
                <button class="close-button" id="closeModalButton">×</button>
            </div>
            <div class="profile-modal-content">
                <div class="profile-image-large">
                    <img src="${post.user.profileImage || '/static/images/default-profile.png'}" alt="Profile">
                </div>
                <div class="profile-name">원숭이는귀여워</div>
                <div class="profile-description">다같이 고릴라</div>

                <div class="profile-stats">
                    <div class="stat">
                        <div class="stat-number">15</div>
                        <div class="stat-label">보유 팔로워 수</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">43</div>
                        <div class="stat-label">친구 수</div>
                    </div>
                </div>

                <div class="profile-actions">
                    <button class="action-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                                d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="20" y1="8" x2="20" y2="14"></line>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                    </button>
                    <button class="action-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                    </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- 댓글 모달 -->
        <div class="comments-modal" id="commentsModal">
            <div class="comments-modal-header">
                <button class="close-button" id="closeCommentsButton">×</button>
                <div class="comments-title">댓글</div>
                <div style="width: 20px;"></div> <!-- 우측 여백용 -->
            </div>
            
            <div class="comments-list" id="commentsList">
                <!-- 댓글 리스트는 동적으로 추가됩니다 -->
            </div>
            
            <div class="emoji-selector">
                <span class="emoji-item">❤️</span>
                <span class="emoji-item">🙌</span>
                <span class="emoji-item">🔥</span>
                <span class="emoji-item">👏</span>
                <span class="emoji-item">😢</span>
                <span class="emoji-item">😍</span>
                <span class="emoji-item">😮</span>
                <span class="emoji-item">😂</span>
            </div>
            
            <div class="comment-input-container">
                <div class="comment-user-image-small">
                    <img src="/images/default-profile.jpg" alt="Your Profile">
                </div>
                <div class="comment-input-wrapper">
                    <input type="text" class="comment-input" id="commentInput" placeholder="댓글 달기...">
                    <button class="comment-submit" id="submitComment" disabled>게시</button>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="script">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
        $(document).ready(function() {
            // 프로필 모달을 열기 위한 함수
            function openProfileModal(userData) {
                // 사용자 데이터로 모달 내용 업데이트
                $('#profileModal .profile-image-large img').attr('src', userData.profileImage || '/static/images/default-profile.png');
                $('#profileModal .profile-name').text(userData.nickname);
                $('#profileModal .profile-description').text(userData.description || '설명이 없습니다');
                $('#profileModal .profile-stats .stat:nth-child(1) .stat-number').text(userData.followersCount || 0);
                $('#profileModal .profile-stats .stat:nth-child(2) .stat-number').text(userData.friendsCount || 0);

                // 모달 표시
                $('#profileModal').addClass('show');
                $('#modalOverlay').addClass('show');
                document.body.style.overflow = 'hidden'; // 모달 열릴 때 스크롤 방지
            }

            // 프로필 이미지를 클릭했을 때 모달 열기
            $('.post-profile-trigger').on('click', function() {
                const userData = $(this).data('user');
                openProfileModal(userData);
            });
            
            
            
            
            // 현재 선택된 게시물 ID (댓글 기능에 사용)
            let currentPostId = null;

            // 모달 닫기 함수
            function closeModal() {
                profileModal.classList.remove('show');
                modalOverlay.classList.remove('show');
                document.body.style.overflow = 'auto'; // 스크롤 다시 활성화
            }

            // 댓글 모달 닫기 함수
            function closeCommentsModal() {
                commentsModal.classList.remove('show');
                modalOverlay.classList.remove('show');
                document.body.style.overflow = 'auto'; // 스크롤 다시 활성화
                currentPostId = null; // 현재 게시물 ID 리셋
            }

            // 모달 닫기 이벤트 리스너 추가
            closeModalButton.addEventListener('click', closeModal);
            closeCommentsButton.addEventListener('click', closeCommentsModal);
            
            // 오버레이 클릭 시 열려있는 모달 닫기
            modalOverlay.addEventListener('click', function() {
                if (profileModal.classList.contains('show')) {
                    closeModal();
                }
                if (commentsModal.classList.contains('show')) {
                    closeCommentsModal();
                }
            });

            // 댓글 모달 열기 함수
            function openCommentsModal(postId) {
                currentPostId = postId;
                
                // 댓글 불러오기
                loadComments(postId);
                
                // 프로필 모달이 열려 있으면 닫기
                if (profileModal.classList.contains('show')) {
                    closeModal();
                }
                
                // 댓글 모달 표시
                commentsModal.classList.add('show');
                modalOverlay.classList.add('show');
                document.body.style.overflow = 'hidden'; // 모달 열릴 때 스크롤 방지
                
                // 입력 필드에 포커스
                setTimeout(() => {
                    commentInput.focus();
                }, 300);
            }

            // 댓글 불러오기 함수
            function loadComments(postId) {
                const sampleComments = [
                    // 테스트용 댓글 데이터
                    {
                        id: 1,
                        user: {
                            id: 101,
                            nickname: 'daegu_unniya',
                            profileImage: '퉁퉁이.jpg'
                        },
                        text: '짧은 댓글 텍스트',
                        createdAt: '3일',
                        likesCount: 265
                    }
                    // 다른 댓글들...
                ];
                
                $('#commentsList').empty();
                
                sampleComments.forEach(comment => {
                    const commentHtml = `
                        <div class="comment-item">
                            <div class="comment-user-image">
                                <img src="/images/${comment.user.profileImage}" alt="Profile">
                            </div>
                            <div class="comment-content">
                                <div class="comment-user-name">${comment.user.nickname}</div>
                                <div class="comment-text">${comment.text}</div>
                                <div class="comment-time">${comment.createdAt}</div>
                                <div class="comment-actions">
                                    <span class="comment-like">좋아요 ${comment.likesCount}</span>
                                    <span class="comment-reply">답글 달기</span>
                                </div>
                            </div>
                        </div>
                    `;
                    $('#commentsList').append(commentHtml);
                });
            }

            // 이모지 선택기 이벤트
            $('.emoji-item').on('click', function() {
                const emoji = $(this).text();
                commentInput.value += emoji;
                commentInput.focus();
                submitComment.disabled = !commentInput.value.trim();

                // 댓글 모달이 열려 있지 않으면 열기
                if (!commentsModal.classList.contains('show')) {
                    openCommentsModal(currentPostId);
                }
            });

            // 댓글 입력 이벤트 처리
            commentInput.addEventListener('input', function() {
                submitComment.disabled = !this.value.trim();
            });
            
            // 댓글 제출 처리
            submitComment.addEventListener('click', function() {
                const commentText = commentInput.value.trim();
                if (!commentText || !currentPostId) return;
                
                // 서버에 댓글을 저장하는 AJAX 요청 (예시로는 화면에만 추가)
                const newComment = {
                    id: Date.now(),
                    user: { id: 999, nickname: '나', profileImage: 'default-profile.jpg' },
                    text: commentText,
                    createdAt: '방금',
                    likesCount: 0
                };
                
                const commentHtml = `
                    <div class="comment-item">
                        <div class="comment-user-image">
                            <img src="/images/${newComment.user.profileImage}" alt="Profile">
                        </div>
                        <div class="comment-content">
                            <div class="comment-user-name">${newComment.user.nickname}</div>
                            <div class="comment-text">${newComment.text}</div>
                            <div class="comment-time">${newComment.createdAt}</div>
                            <div class="comment-actions">
                                <span class="comment-like">좋아요 ${newComment.likesCount}</span>
                                <span class="comment-reply">답글 달기</span>
                            </div>
                        </div>
                    </div>
                `;
                
                $('#commentsList').append(commentHtml);
                
                // 입력 필드 초기화
                commentInput.value = '';
                submitComment.disabled = true;
                
                // 스크롤을 맨 아래로 이동
                const commentsList = document.getElementById('commentsList');
                commentsList.scrollTop = commentsList.scrollHeight;
            });
       

            
        
            // Enter 키로 댓글 입력
            commentInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey && !submitComment.disabled) {
                    e.preventDefault();
                    submitComment.click();
                }
            });
            
          
		    // 초기 정적 게시물 - 동적 모달 함수를 사용하도록 업데이트
		    $("#profileImageTrigger").on('click', function() {
		        // 정적 게시물에서 데이터 사용
		        const userData = {
		            profileImage: '퉁퉁이.jpg',
		            nickname: '고릴랑',
		            description: '다같이 고릴라',
		            followersCount: 120,
		            friendsCount: 43
		        };
		        openProfileModal(userData);
		    });

		    // 게시물 목록을 가져와서 화면에 동적으로 추가하는 함수
		    function loadPosts() {
		        $.ajax({
		            url: '/api/with-details',  // 서버에서 게시물 데이터를 받는 API 엔드포인트
		            method: 'GET',
		            success: function(data) {
		                $('#postsContainer').empty(); // 기존 게시물 제거 (선택사항)
		                
		                data.forEach(post => {
		                    const postHtml = `
		                        <div class="post-container">
		                            <!-- 사용자 정보 -->
		                            <div class="post-user">
		                                <div class="post-user-image post-profile-trigger" data-user='${JSON.stringify(post.user)}'>
		                                    <img src="${post.user.profileImage || '/static/images/default-profile.png'}" alt="Profile">
		                                </div>
		                                <div class="post-user-info">
		                                    <div class="post-user-details">
		                                        <div class="post-user-name">${post.user.nickname}</div>
		                                        <div class="post-user-follower">팔로워 ${post.user.followersCount || 0}</div>
		                                    </div>
		                                    <button class="follow-button">팔로우</button>
		                                </div>
		                            </div>

		                            <!-- 게시물 이미지 -->
		                            ${post.images.map(image => `
		                                <img src="/images/${image.fileName}" alt="Post Image" class="post-image">
		                            `).join('')}

		                            <!-- 게시물 액션 -->
		                            <div class="post-actions">
		                                <div class="post-action-buttons">
		                                    
		                                <button>
		                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
		                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
		                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		                                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
		                                        </svg>
		                                        ${post.likesCount || 0}
		                                    </button>
		                                    <button>
		                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
		                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
		                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		                                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
		                                        </svg>
		                                        ${post.commentCount || 0}
		                                    </button>
		                                </div>
		                            </div>

		                            <!-- 게시물 설명 -->
		                            <div class="post-caption">${post.content}</div>

		                            <!-- 해시태그 -->
		                            <div class="hashtags-container">
		                                ${post.hashtags ? post.hashtags.map(tag => `<span class="hashtag">#${tag}</span>`).join(' ') : '<span class="hashtag">#운동</span> <span class="hashtag">#일상</span>'}
		                            </div>
		                        </div>
		                    `;
		                    $('#postsContainer').append(postHtml);
		                });
		                
		                // 동적으로 생성된 프로필 이미지에 클릭 이벤트 추가
		                $('.post-profile-trigger').on('click', function() {
		                    const userData = $(this).data('user');
		                    openProfileModal(userData);
		                });
		            },
		            error: function(xhr, status, error) {
		                console.error('게시물을 불러오는 중 오류 발생:', error);
		            }
		        });
		    }

		    // 초기 게시물 불러오기
		    loadPosts();
		});
</script>
	</th:block>
</body>
</html>