<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<head>
<th:block layout:fragment="css">
	<style>
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
	font-size: 1rem;
}


.container {
	width: 100%;
	max-width: 46.875rem;
	background-color: white;
	min-height: 100vh;
	box-shadow: 0 0 0.625rem rgba(0, 0, 0, 0.1);
	position: relative;
}


/* Top search bar styles - using your original code */
.search-bar {
	display: flex;
	align-items: center;
	padding: 10px 15px;
	border-bottom: 1px solid #e0e0e0;
}

.search-options {
	display: flex;
	align-items: center;
	gap: 10px;
	flex-grow: 1;
}

.search-option {
	font-size: 14px;
	font-weight: bold;
	color: #000;
	cursor: pointer;
}

.search-option.inactive {
	color: #888;
}

.plus-button {
	width: 1.5625rem;
	height: 1.5625rem;
	background-color: transparent;
	border: none;
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
}

/* Main content styles - updated to match image */
.main-content {
	padding: 20px;
	display: flex;
	flex-direction: column;
	align-items: center;
	text-align: center;
}

.friends-icon {
	margin: 20px 0;
}

.welcome-text {
	font-size: 18px;
	font-weight: bold;
	line-height: 1.5;
	margin-bottom: 40px;
	color: #333;
}

.trending-section {
	width: 100%;
}

.trending-header {
	display: flex;
	align-items: center;
	margin-bottom: 15px;
}

.fire-icon {
	margin-right: 8px;
	color: #ff7700;
}

.trending-title {
	font-size: 16px;
	font-weight: bold;
}

.profile-cards-wrapper {
	overflow-x: auto;
	-webkit-overflow-scrolling: touch;
	scroll-snap-type: x mandatory;
	display: flex;
	padding-bottom: 10px;
}

.profile-cards {
	display: flex;
	gap: 15px;
	padding: 10px;
	width: max-content;
}

.profile-card {
	background-color: #f5f7f9;
	border-radius: 10px;
	padding: 15px;
	width: 160px; /* 두 개씩 보여지도록 고정 */
	flex-shrink: 0;
	display: flex;
	flex-direction: column;
	align-items: center;
	scroll-snap-align: start;
}

.profile-image {
	width: 60px;
	height: 60px;
	border-radius: 50%;
	background-color: #ddd;
	margin-bottom: 10px;
	overflow: hidden;
}

.profile-image img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.profile-name {
	font-size: 14px;
	font-weight: bold;
	margin-bottom: 5px;
}

.profile-followers {
	font-size: 12px;
	color: #888;
	margin-bottom: 10px;
}

.follow-button {
	background-color: #065F79;
	color: white;
	border: none;
	border-radius: 0.25rem;
	padding: 0.3125rem 0.625rem;
	font-size: 0.75rem;
	cursor: pointer;
}

/* Bottom navigation - using your original code */
.bottom-nav {
	position: fixed;
	bottom: 0;
	width: 375px;
	display: flex;
	justify-content: space-around;
	background-color: white;
	border-top: 1px solid #eee;
	padding: 10px 0;
}

.bottom-nav-item {
	text-align: center;
	flex: 1;
	cursor: pointer;
	display: flex;
	flex-direction: column;
	align-items: center;
	font-size: 10px;
	color: #888;
}

.bottom-nav-item.active {
	color: #000;
}

.bottom-nav-item svg {
	margin-bottom: 5px;
}

.bottom-nav-text {
	font-size: 10px;
}

/* Category tabs styles */
.category-tabs {
	display: flex;
	background-color: #fff;
	border-bottom: 0.0625rem solid #e0e0e0;
	position: sticky;
	top: 0;
	z-index: 10;
}

.category-tab {
	flex: 1;
	text-align: center;
	padding: 0.75rem 0;
	font-size: 0.875rem;
	color: #666;
	background: transparent;
	border: none;
	cursor: pointer;
}

.category-tab.active {
	color: #000;
	font-weight: bold;
	background-color: #E6EEF0;
}

.post-user {
	display: flex;
	align-items: center;
	padding: 0.625rem;
}

.post-user-image {
	width: 2.5rem;
	height: 2.5rem;
	border-radius: 50%;
	margin-right: 0.625rem;
	background-color: #ddd;
	overflow: hidden;
	cursor: pointer;
}

.post-user-image img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.post-user-info {
	flex-grow: 1;
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.post-user-details {
	display: flex;
	flex-direction: column;
}

.post-user-name {
	font-weight: bold;
}

.post-user-follower {
	color: #999;
	font-size: 0.75rem;
}

.post-image {
	width: 100%;
	max-height: 31.25rem;
	object-fit: cover;
}

.post-actions {
	display: flex;
	justify-content: space-between;
	padding: 0.625rem;
	border-bottom: 0.0625rem solid #e0e0e0;
}

.post-action-buttons {
	display: flex;
	gap: 0.9375rem;
}

.post-action-buttons button {
	background: none;
	border: none;
	display: flex;
	align-items: center;
	gap: 0.3125rem;
	font-size: 0.875rem;
	cursor: pointer;
}

.post-caption {
	padding: 0.625rem;
	font-size: 0.875rem;
}

.hashtags-container {
	padding: 0 0.625rem 0.625rem;
	display: flex;
	flex-wrap: wrap;
	gap: 0.5rem;
}

.hashtag {
	padding: 0.25rem 0.625rem;
	color: #8B8B8B;
	font-size: 0.75rem;
	font-weight: 600;
	border-radius: 0.3125rem;
	background-color: #EFEFEF;
	display: inline-block;
}

/* Profile Modal Styles */
.profile-modal {
	position: fixed;
	bottom: 2.5rem;
	left: 0;
	right: 0;
	margin: 0 auto;
	max-width: 23.4375rem;
	background-color: #f3f9fb;
	border-top-left-radius: 1.25rem;
	border-top-right-radius: 1.25rem;
	z-index: 100;
	box-shadow: 0 -0.125rem 0.625rem rgba(0, 0, 0, 0.1);
	display: none;
}

.profile-modal.show {
	display: block;
}

.profile-modal-header {
	display: flex;
	justify-content: flex-end;
	padding: 0.625rem;
}

.close-button {
	background: none;
	border: none;
	font-size: 1.25rem;
	color: #888;
	cursor: pointer;
}

.profile-modal-content {
	padding: 0.625rem 1.25rem 1.25rem;
	text-align: center;
}

.profile-image-large {
	width: 5rem;
	height: 5rem;
	border-radius: 50%;
	margin: 0 auto 0.9375rem;
	overflow: hidden;
	background-color: #ddd;
}

.profile-image-large img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.profile-name {
	font-size: 1.125rem;
	font-weight: bold;
	margin-bottom: 0.3125rem;
}

.profile-description {
	color: #888;
	font-size: 0.875rem;
	margin-bottom: 1.25rem;
}

.profile-stats {
	display: flex;
	justify-content: center;
	border-top: 0.0625rem solid #e0e0e0;
	border-bottom: 0.0625rem solid #e0e0e0;
	padding: 0.9375rem 0;
	margin-bottom: 1.25rem;
}

.stat {
	flex: 1;
	text-align: center;
}

.stat-number {
	font-size: 1.125rem;
	font-weight: bold;
}

.stat-label {
	font-size: 0.75rem;
	color: #888;
}

.profile-actions {
	display: flex;
	justify-content: center;
	gap: 0.625rem;
	margin-bottom: 1.25rem;
}

.action-button {
	background-color: #f0f0f0;
	border: none;
	border-radius: 1.25rem;
	padding: 0.5rem 0.9375rem;
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
}

/* Comments Modal Styles */
.comments-modal {
	position: fixed;
	bottom: 4.375rem;
	left: 0;
	right: 0;
	margin: 0 auto;
	max-width: 30.4375rem;
	height: 70vh;
	background-color: white;
	border-top-left-radius: 1.25rem;
	border-top-right-radius: 1.25rem;
	z-index: 100;
	box-shadow: 0 -0.125rem 0.625rem rgba(0, 0, 0, 0.1);
	display: none;
	flex-direction: column;
}

.comments-modal.show {
	display: flex;
}

.comments-modal-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 0.9375rem;
	border-bottom: 0.0625rem solid #e0e0e0;
}

.comments-title {
	font-weight: bold;
	flex-grow: 1;
	text-align: center;
}

.comments-list {
	flex-grow: 1;
	overflow-y: auto;
	padding: 0.625rem 0;
}

.comment-item {
	display: flex;
	padding: 0.625rem 0.9375rem;
}

.comment-user-image {
	width: 2.25rem;
	height: 2.25rem;
	border-radius: 50%;
	margin-right: 0.625rem;
	background-color: #ddd;
	overflow: hidden;
}

.comment-user-image img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.comment-content {
	flex-grow: 1;
}

.comment-user-name {
	font-weight: bold;
	margin-bottom: 0.125rem;
}

.comment-text {
	font-size: 0.875rem;
	line-height: 1.4;
}

.comment-time {
	font-size: 0.75rem;
	color: #888;
	margin-top: 0.1875rem;
}

.comment-actions {
	display: flex;
	gap: 0.9375rem;
	margin-top: 0.3125rem;
	font-size: 0.75rem;
	color: #888;
}

.comment-reply {
	cursor: pointer;
}

.comment-input-container {
	display: flex;
	align-items: center;
	padding: 0.625rem 0.9375rem;
	border-top: 0.0625rem solid #e0e0e0;
	background-color: white;
}

.comment-user-image-small {
	width: 2rem;
	height: 2rem;
	border-radius: 50%;
	margin-right: 0.625rem;
	background-color: #ddd;
	overflow: hidden;
}

.comment-user-image-small img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.comment-input-wrapper {
	flex-grow: 1;
	display: flex;
	align-items: center;
	border-radius: 1.25rem;
	background-color: #f0f0f0;
	padding: 0.5rem 0.9375rem;
}

.comment-input {
	flex-grow: 1;
	border: none;
	background: transparent;
	outline: none;
	font-size: 0.875rem;
}

.comment-submit {
	color: #065F79;
	font-weight: bold;
	font-size: 0.875rem;
	background: none;
	border: none;
	padding: 0 0.3125rem;
	cursor: pointer;
}

.comment-submit:disabled {
	color: #ccc;
	cursor: default;
}


.modal-overlay {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5);
	z-index: 99;
	display: none;
}

.modal-overlay.show {
	display: block;
}

.like-button.liked svg path {
	fill: red;
	stroke: red;
}

.post-images-wrapper {
	overflow-x: hidden; /* 가로 스크롤 제거 */
	-webkit-overflow-scrolling: touch;
	scroll-snap-type: x mandatory;
	display: flex;
	transition: height 0.3s ease; /* 높이 전환 애니메이션 */
}

.post-images-scroll {
	display: flex;
	width: 100%;
	overflow-x: auto; /* 가로 스크롤 여기서 처리 */
	scroll-snap-type: x mandatory;
	-webkit-overflow-scrolling: touch;
	scrollbar-width: none; /* Firefox */
	-ms-overflow-style: none; /* IE 10+ */
}

.post-images-scroll::-webkit-scrollbar {
	display: none; /* Chrome, Safari, Opera */
}

.post-image-container {
	flex: 0 0 100vw; /* 화면 전체 너비로 고정 */
	scroll-snap-align: start;
	display: flex;
	justify-content: center;
	align-items: center;
	margin: 5px;
}

.post-image-swipe {
	width: 98vw;
	height: auto;
	object-fit: contain;
	display: block;
	max-height: 100vh; /* 너무 큰 이미지 제한 */
	border-radius: 5%;
}

</style>
</th:block>
</head>
<body>
	<div layout:fragment="content">
		<div class="container">
			<div class="search-bar">
				<div class="search-options">
					<span id="allFeed" class="search-option inactive">전체</span> 
					<span id="followingFeed" class="search-option active">팔로잉</span> 
					<span id="popularFeed" class="search-option inactive">인기</span>
				</div>
				<button class="plus-button">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
						viewBox="0 0 24 24" fill="none" stroke="currentColor"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   						<line x1="12" y1="5" x2="12" y2="19"></line>
    					<line x1="5" y1="12" x2="19" y2="12"></line>
 					 </svg>
				</button>
			</div>

			<!-- "요즘 뜨는 이웃" 섹션 -->
			<div id="noFollowingSection">
				<div class="main-content">
					<div class="friends-icon">
						<img alt="" src="/images/팔로잉피드.svg">
					</div>
					<div class="welcome-text">
						나만의 팔로잉 피드를<br>만들어보세요!
					</div>
					<div class="trending-section">
						<div class="trending-header">
							<div class="fire-icon">
								<img alt="" src="/images/불꽃.svg">
							</div>
							<div class="trending-title">요즘 뜨는 이웃</div>
						</div>
						<div class="profile-cards-wrapper">
							<div class="profile-cards" id="trendingUserCards">
								<!-- JS로 유저 카드가 동적으로 들어감 -->
							</div>
						</div>
					</div>
				</div>
			</div>


			<!-- Main Feed Section -->
			<div id="mainContentWrapper" style="display: none;">
				<div id="postsContainer"></div>
						<div class="comments-modal" id="commentsModal">
			<div class="comments-modal-header">
				<!-- 댓글 모달 닫기 버튼 -->
				<button class="close-button" id="closeCommentsButton">×</button>
				<div class="comments-title">댓글</div>
				<div style="width: 20px;"></div>
				<!-- 우측 여백용 -->
			</div>

			<div class="comments-list" id="commentsList">
				<!-- 댓글 리스트는 동적으로 추가됩니다 -->
			</div>


			<!-- 댓글 입력 영역 -->
			<div class="comment-input-container">
				<div class="comment-user-image-small">
					<img src="/images/default-profile.jpg" alt="Your Profile">
				</div>
				<div class="comment-input-wrapper">
					<input type="text" class="comment-input" id="commentInput"
						placeholder="댓글 달기...">
					<button class="comment-submit" id="submitComment" disabled>게시</button>
				</div>
			</div>
		</div>
			</div>
		</div>
	</div>



	<th:block layout:fragment="script">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script>
		$(document).ready(function () {
		    const currentUserId = 2; // 실제 로그인된 유저 ID로 설정
		    let selectedCategory = '전체';
		    let currentPostId = null;

		    checkFollowingAndLoadFeed();

		    // 팔로잉 유저 확인 및 피드 로드
		  function checkFollowingAndLoadFeed() {
    $.ajax({
        url: '/api/following-users',
        method: 'GET',
        data: { userId: currentUserId },
        cache: false, // 캐시 방지
        success: function (followingUserIds) {
            const hasFollowing = Array.isArray(followingUserIds) && followingUserIds.length > 0;

            if (!hasFollowing) {
                $('#mainContentWrapper').hide();
                $('#noFollowingSection').show();

                // ✅ "요즘 뜨는 이웃" DOM 클리어 후에 불러오기 시작
                const container = $('#trendingUserCards');
                container.empty().append('<div class="loading">로딩 중...</div>');

                // 추천 유저 불러오기
                $.ajax({
                    url: '/api/recommended-users',
                    method: 'GET',
                    data: { userId: currentUserId },
                    cache: false,
                    success: function (recommendedUsers) {
                        container.empty(); // 로딩 제거
                        
                        if (Array.isArray(recommendedUsers) && recommendedUsers.length > 0) {
                            recommendedUsers.forEach(user => {
                                const userHtml = `
                                    <div class="profile-card">
                                        <div class="profile-image">
                                            <img src="/images/${user.profileImage || '기본이미지.png'}" alt="${user.nickname} 프로필">
                                        </div>
                                        <div class="profile-name">${user.nickname}</div>
                                        <div class="profile-followers">팔로워 ${user.followerCount}</div>
                                        <button class="follow-button" data-user-id="${user.id}">팔로우</button>
                                    </div>
                                `;
                                container.append(userHtml);
                            });

                            // follow 버튼 이벤트 바인딩
                            container.find('.follow-button').on('click', function () {
                                const targetUserId = $(this).data('user-id');
                                const button = $(this);

                                $.ajax({
                                    url: '/api/follow/toggle',
                                    method: 'POST',
                                    data: {
                                        userId: currentUserId,
                                        targetUserId: targetUserId
                                    },
                                    success: function (isFollowing) {
                                        button.text(isFollowing ? '팔로잉' : '팔로우');
                                    },
                                    error: function () {
                                        alert('팔로우에 실패했습니다.');
                                    }
                                });
                            });

                        } else {
                            container.append('<div class="no-recommendations">추천 유저가 없습니다.</div>');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('추천 유저 불러오기 실패:', error);
                        container.empty().append('<div class="error">추천 유저를 불러오는 데 실패했습니다.</div>');
                    }
                });

            } else {
                $('#noFollowingSection').hide();
                $('#mainContentWrapper').show();
                loadFollowingFeed(currentUserId, followingUserIds);
            }
        },
        error: function (xhr, status, error) {
            console.error('팔로우 목록 로딩 실패:', error);
        }
    });
}

		    // 팔로우한 유저들의 피드를 불러오는 함수
		    function loadFollowingFeed(userId, followingUserIds) {
		        $.ajax({
		            url: '/api/with-details',
		            method: 'GET',
		            data: { userId: userId },
		            success: function (data) {
		                $('#postsContainer').empty();

		                const filteredPosts = data.filter(post => followingUserIds.includes(post.user.id));

		                filteredPosts.forEach(post => {
		                    const hashtagsHtml = post.hashtags
		                        ? post.hashtags.map(tag => `<span class="hashtag">#${tag.tag}</span>`).join(' ')
		                        : '';

		                    const postHtml = `
		                        <div class="post-container" data-post-id="${post.id}">
		                            <div class="post-user">
		                                <div class="post-user-image post-profile-trigger" data-user='${JSON.stringify(post.user)}'>
		                                    <img src="/images/${post.user.profileImage}" alt="Profile">
		                                </div>
		                                <div class="post-user-info">
		                                    <div class="post-user-details">
		                                        <div class="post-user-name">${post.user.nickname}</div>
		                                        <div class="post-user-follower">팔로워 ${post.followerCount || 0}</div>
		                                    </div>
		                                    <button class="follow-button" data-user-id="${post.user.id}">
		                                        ${post.followedByCurrentUser ? '팔로잉' : '팔로우'}
		                                    </button>
		                                </div>
		                            </div>
		                            <div class="post-images-wrapper">
		                            <div class="post-images-scroll">
		                              ${post.images.map(image => `
		                                <div class="post-image-container">
		                                  <img src="/images/${image.fileName}" alt="Post Image" class="post-image-swipe" ondblclick="handleImageDoubleClick(${post.id})">
		                                </div>
		                              `).join('')}
		                            </div>
		                          </div>
		                            <div class="post-actions">
		                                <div class="post-action-buttons">
		                                    <button class="like-button ${post.likedByCurrentUser ? 'liked' : ''}" data-post-id="${post.id}" data-liked="${post.likedByCurrentUser}">
		                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		                                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
		                                        </svg>
		                                        <span>${post.likesCount || 0}</span>
		                                    </button>
		                                    <button class="comment-button">
		                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		                                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
		                                        </svg>
		                                        ${post.commentCount || 0}
		                                    </button>
		                                </div>
		                            </div>
		                            <div class="post-caption">${post.content}</div>
		                            <div class="hashtags-container">${hashtagsHtml}</div>
		                        </div>
		                    `;
		                    $('#postsContainer').append(postHtml);
		                });
		                $('.post-images-scroll').each(function () {
		                    const scrollContainer = $(this)[0];
		                    const scrollWidth = scrollContainer.scrollWidth;
		                    const visibleWidth = scrollContainer.clientWidth;
		                    const scrollAmount = (scrollWidth - visibleWidth) / 2;

		                    scrollContainer.scrollLeft = scrollAmount;
		                });
		                attachEventHandlers();
		            },
		            error: function (xhr, status, error) {
		                console.error('게시물을 불러오는 중 오류 발생:', error);
		            }
		        });
		    }

		    // 좋아요, 댓글, 팔로우 기능 처리
		    function attachEventHandlers() {
		        $('.comment-button').on('click', function () {
		            const postId = $(this).closest('.post-container').data('post-id');
		            openCommentsModal(postId);
		        });

		        $('.post-profile-trigger').on('click', function () {
		            const userData = $(this).data('user');
		            openProfileModal(userData);
		        });

		        
		        $('#commentInput').on('input', function() {
		            $('#submitComment').prop('disabled', !$(this).val().trim());
		        });

		        $('#submitComment').on('click', function() {
		            const commentText = $('#commentInput').val().trim();
		            if (!commentText || !currentPostId) return;

		            const newComment = {
		                boardId: currentPostId,
		                userId: 2,
		                comment: commentText
		            };

		            $.ajax({
		                url: '/api',
		                method: 'POST',
		                contentType: 'application/json',
		                data: JSON.stringify(newComment),
		                success: function() {
		                    $('#commentInput').val('');
		                    $('#submitComment').prop('disabled', true);
		                    loadComments(currentPostId);
		                },
		                error: function(xhr, status, error) {
		                    console.error('댓글 추가 실패:', error);
		                }
		            });
		        });

		        $('#commentInput').on('keypress', function(e) {
		            if (e.key === 'Enter' && !e.shiftKey && !$('#submitComment').prop('disabled')) {
		                e.preventDefault();
		                $('#submitComment').click();
		            }
		        });
		        
		        $('#closeCommentsButton').on('click', closeCommentsModal);
		        
		        $('.follow-button').on('click', function () {
		            const button = $(this);
		            const targetUserId = button.data('user-id');

		            $.ajax({
		                url: '/api/follow/toggle',
		                method: 'POST',
		                data: { userId: currentUserId, targetUserId: targetUserId },
		                success: function (isFollowing) {
		                    button.text(isFollowing ? '팔로잉' : '팔로우');
		                    button.toggleClass('followed', isFollowing);

		                    $.ajax({
		                        url: '/api/follow/followers',
		                        method: 'GET',
		                        data: { targetUserId: targetUserId },
		                        success: function (followerCount) {
		                            button.closest('.post-user-info').find('.post-user-follower')
		                                .text('팔로워 ' + followerCount);
		                        },
		                        error: function (xhr, status, error) {
		                            console.error('팔로워 수 업데이트 오류:', error);
		                        }
		                    });
		                },
		                error: function (xhr, status, error) {
		                    console.error('팔로우 상태 변경 오류:', error);
		                }
		            });
		        });
		        
		        $('.post-image-swipe').on('dblclick', function() {
		            const postId = $(this).closest('.post-container').data('post-id');
		            handleLikeOnDoubleClick(postId);
		        });

		        
		        $('.like-button').on('click', function () {
		            const likeButton = $(this);
		            const postId = likeButton.data('post-id');

		            $.ajax({
		                url: `/api/${postId}/like-toggle`,
		                method: 'POST',
		                contentType: 'application/json',
		                data: JSON.stringify({ userId: currentUserId }),
		                success: function (response) {
		                    likeButton.find('span').text(response.likesCount);
		                    likeButton.data('liked', response.liked);
		                    likeButton.toggleClass('liked', response.liked);
		                },
		                error: function (xhr, status, error) {
		                    console.error('좋아요 처리 중 오류 발생:', error);
		                }
		            });
		        });
		    }

		    function openCommentsModal(postId) {
		        currentPostId = postId;
		        loadComments(postId);
		        $('#commentsModal').addClass('show');
		        $('#commentmodalOverlay').addClass('show');
		        document.body.style.overflow = 'hidden';
		        setTimeout(() => $('#commentInput').focus(), 300);
		    }
		    
		    function closeCommentsModal() {
		        $('#commentsModal').removeClass('show');
		        $('#commentmodalOverlay').removeClass('show');
		        document.body.style.overflow = 'auto';
		        currentPostId = null;
		    }

		    function loadComments(postId) {
		        $.ajax({
		            url: '/api/comments/' + postId,
		            method: 'GET',
		            success: function (data) {
		                $('#commentsList').empty();
		                if (data && data.comments && data.comments.length > 0) {
		                    data.comments.forEach(comment => {
		                        const commentHtml = `
		                            <div class="comment-item">
		                                <div class="comment-user-image">
		                                    <img src="/images/${comment.user.profileImage}" alt="Profile">
		                                </div>
		                                <div class="comment-content">
		                                    <div class="comment-user-name">${comment.user.nickname}</div>
		                                    <div class="comment-text">${comment.comment}</div>
		                                    <div class="comment-time">${comment.createdAt}</div>
		                                    <div class="comment-actions">
		                                        <span class="comment-reply">답글 달기</span>
		                                    </div>
		                                </div>
		                            </div>
		                        `;
		                        $('#commentsList').append(commentHtml);
		                    });
		                } else {
		                    $('#commentsList').append('<div class="no-comments">댓글이 없습니다.</div>');
		                }
		            },
		            error: function (xhr, status, error) {
		                console.error('댓글을 불러오는 중 오류 발생:', error);
		            }
		        });
		    }
		    

		    $('.category-tab').on('click', function () {
		        $('.category-tab').removeClass('active');
		        $(this).addClass('active');
		        selectedCategory = $(this).text().trim();
		        loadFollowingFeed(currentUserId, []);
		    });
		    
		   

		    $(document).on('click', '#allFeed', function () {
		        window.location.href = '/feed/all';
		    });
		    $(document).on('click', '#followingFeed', function () {
		        window.location.href = '/feed/following';
		    });
		    $(document).on('click', '#popularFeed', function () {
		        window.location.href = '/feed/popular';
		    });


		});
		</script>

	</th:block>
</body>
</html>